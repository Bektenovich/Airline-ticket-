#include <iostream>
#include <fstream>
#include <string>
#include <cstdlib>

using namespace std;

// Structure to represent a flight ticket
struct Ticket {
    string id;
    string source;
    string destination;
    string date;
    string time;
    int seatsAvailable;
    double price;
};

// Global array to store tickets
Ticket tickets[100];
int numTickets = 0;

// Function prototypes
void saveTicketsToFile();
void loadTicketsFromFile();
void displayAllTickets();
void addTicket();

int main() {
    loadTicketsFromFile();
    
    while (true) {
        cout << "\nAirline Ticket Reservation System\n";
        cout << "1. Display all tickets\n";
        cout << "2. Add a new ticket\n";
        cout << "3. Save tickets to file\n";
        cout << "4. Exit\n";
        cout << "Enter your choice: ";
        
        int choice;
        cin >> choice;
        
        switch(choice) {
            case 1:
                displayAllTickets();
                break;
            case 2:
                addTicket();
                break;
            case 3:
                saveTicketsToFile();
                break;
            case 4:
                cout << "Exiting program.\n";
                return 0;
            default:
                cout << "Invalid choice. Please try again.\n";
        }
    }
    
    return 0;
}

// Function to save tickets to file
void saveTicketsToFile() {
    ofstream file("tickets.txt");
    if (file.is_open()) {
        for (int i = 0; i < numTickets; ++i) {
            file << tickets[i].id << ","
                 << tickets[i].source << ","
                 << tickets[i].destination << ","
                 << tickets[i].date << ","
                 << tickets[i].time << ","
                 << tickets[i].seatsAvailable << ","
                 << tickets[i].price << "\n";
        }
        file.close();
        cout << "Tickets saved to file.\n";
    } else {
        cout << "Unable to open file for saving tickets.\n";
    }
}

// Function to load tickets from file
void loadTicketsFromFile() {
    ifstream file("tickets.txt");
    if (file.is_open()) {
        while (!file.eof()) {
            file >> tickets[numTickets].id;
            file.ignore();
            getline(file, tickets[numTickets].source, ',');
            getline(file, tickets[numTickets].destination, ',');
            getline(file, tickets[numTickets].date, ',');
            getline(file, tickets[numTickets].time, ',');
            file >> tickets[numTickets].seatsAvailable;
            file.ignore();
            file >> tickets[numTickets].price;
            file.ignore();
            ++numTickets;
        }
        file.close();
        cout << "Tickets loaded from file.\n";
    } else {
        cout << "No tickets found. Please add some tickets first.\n";
    }
}

// Function to display all tickets
void displayAllTickets() {
    if (numTickets == 0) {
        cout << "No tickets found. Please add some tickets first.\n";
        return;
    }

    cout << "ID\tSource\tDestination\tDate\t\tTime\tSeats\tPrice\n";
    for (int i = 0; i < numTickets; ++i) {
        cout << tickets[i].id << "\t"
             << tickets[i].source << "\t"
             << tickets[i].destination << "\t"
             << tickets[i].date << "\t"
             << tickets[i].time << "\t"
             << tickets[i].seatsAvailable << "\t"
             << tickets[i].price << "\n";
    }
}

// Function to add a new ticket
void addTicket() {
    cout << "Enter ticket details:\n";
    cout << "ID: ";
    cin >> tickets[numTickets].id;
    cout << "Source: ";
    cin >> tickets[numTickets].source;
    cout << "Destination: ";
    cin >> tickets[numTickets].destination;
    cout << "Date: ";
    cin >> tickets[numTickets].date;
    cout << "Time: ";
    cin >> tickets[numTickets].time;
    cout << "Seats available: ";
    cin >> tickets[numTickets].seatsAvailable;
    cout << "Price: ";
    cin >> tickets[numTickets].price;
    ++numTickets;
    cout << "Ticket added successfully.\n";
}
